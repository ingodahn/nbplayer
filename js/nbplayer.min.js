function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie),i=n.split(";"),a=0;a<i.length;a++){for(var l=i[a];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(t))return l.substring(t.length,l.length)}return""}function initializePlayer(){var e=getCookie("sageLang");""==e&&(e="sage"),$("#sageLang").find("option[value='"+e+"']").prop("selected",!0),e=getCookie("sageCellsType"),""==e&&(e="linked"),$("#sageCellsType").find("option[value='"+e+"']").prop("selected",!0),e=getCookie("playerPanes"),""==e&&(e="ExecRead"),$("#playerPanes").find("option[value='"+e+"']").prop("selected",!0)}function makePlayer(){$("a").each(function(){$(this).text().match(/^\s*$/)&&$(this).remove()}),$("#controls").remove(),$("#footer").remove(),makeMenu(),addSagecells(".nb-code-cell",".nb-input"),makeTransferData(),makeSageCells(playerConfig),playerConfig.collapsable&&chapterize(),playerConfig.execute&&setExecute()}function addSagecells(e,t){var n="\n  <div class='compute'>\n    <script type='text/x-sage'>1+1</script>\n  </div>";let i="";$(e).each(function(){$(this).append(n),i=$(this).find(t).text().replace(/figure/g,"% figure"),$(this).find(".compute script").text(i),$(this).find(".compute").hide()})}function chapterize(){let e,t,n=0,i=0;$(".nb-worksheet").children().each(function(){let a=$(this);if(a.find("h2").length){let t=a.find("h2").first();n++,i=0,e="chapter_"+n,a.attr("mtheading",e),getInterface(a,e),t.append('<img src="./resources/collapse.gif" onclick= "toggleChapter(\''+e+"')\">")}else if(a.find("h3").length){let n=a.find("h3").first();i++,t=e+"_"+i,a.attr("mtheading",t),a.attr("mtchapter",e),getInterface(a,t),n.append('<img src="./resources/collapse.gif" onclick= "toggleSection(\''+t+"')\">")}else a.attr("mtchapter",e),a.attr("mtsection",t)}),checkInterfaceConsistency()}function getInterface(e,t){if(e.find(".mathtrek").length){let n=e.find(".mathtrek").first();mtin[t]=n.attr("mtin").split(",").map(e=>e.trim()),mtout[t]=n.attr("mtout").split(",").map(e=>e.trim())}}function isDefined(e){let t=mtin[e];for(let e=0;e<t.length;e++)if(""!=t[e]&!definedOps.includes(t[e]))return!1;return!0}function checkExpandable(e){let t=$("."+e+"_heading img").last().first();isDefined(e)?t.show():t.hide()}function toggleExpand(e){if($("."+e).is(":visible").length){let t=mtout[e];$("."+e).hide(),definedOps=definedOps.filter(function(e){return!t.includes(e)})}else $("."+e).show(),definedOps.concat(mtout[e]);$("."+chapter_id+"_heading").siblings("."+e).each(function(){})}initializePlayer(),"expert"!=GetURLParameterWithDefault("level","user")?$(".expertMode").hide():$(".noExpertMode").hide(),$("#sageLang").change(function(){playerConfig.lang=$("#sageLang").val(),document.cookie="sageLang="+playerConfig.lang}),$("#sageCellsType").change(function(){var e=$("#sageCellsType option").filter(":selected").val();switch(e){case"auto":playerConfig.linked=!1,playerConfig.eval=!0;break;case"single":playerConfig.linked=!1,playerConfig.eval=!1;break;default:playerConfig.linked=!0,playerConfig.eval=!1}document.cookie="sageCellsType="+e}),$("#collapsable").change(function(){playerConfig.collapsable=!!$("#collapsable").is(":checked")}),$("#playerPanes").change(function(){var e=$("#playerPanes option").filter(":selected").val();playerConfig.panes=e,playerConfig.execute="ReadExec"!=e,playerConfig.showRead="Exec"!=e,document.cookie="playerPanes="+e});var mtin={},mtout={},definedOps=[];